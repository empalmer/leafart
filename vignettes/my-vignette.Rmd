---
title: "report-vignette"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{report-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
devtools::load_all()
library(tidyverse)
#library(leafart)
```


## Full testing example

```{r}
get_params() %>% 
  create_leaf_pile() %>% 
  plot_leaves()

```

## Growing a leaf: 

A leaf starts with a stalk. We keep track of the stalk start and endpoint, and then draw a line between them. 

Heres a stalk: 

```{r}
(initial_leaf <- tibble(
    x_0 = 0,
    y_0 = 0,
    x_1 = 0,
    y_1 = 1
  ))
```

This format makes it harder to plot. The function `rake_leaves()` will transform the leaf into something better suited to plotting. 

```{r}
(rake_leaves(initial_leaf))

rake_leaves(initial_leaf) %>% 
  ggplot(aes(x = x, y = y)) + geom_path()
```

We consider this initial stalk to be the first "layer"

Now lets create some branches. The way the leaf/tree branches depends on the parameter values we pass to the growing function. These parameters could be single values, or a vector of values to be sampled from. 

We need to know the number of branches to branch off from, the angle to branch, and how long the new branches should be. 

The function `get_params()` will give us a list of parameter values. We can specify what values we want, or we can use its defaults. It will default to making one tree. Since we just want to make a tree with 2 layers now, we will also specify that. 

```{r}
params <- get_params(n_layer = 2,
                     scale = .5,
                     angle = 90,
                     split = 2)
```


To grow one branch, we use the function `one_branch()`. This function creates a new list that contains the growth of the new branch. Note the initial stalk also keeps track of some initial angle values. 

```{r}
initial_leaf <- tibble(
    x_0 = 0,
    y_0 = 0,
    x_1 = x_0,
    y_1 = y_0 + 1,
    angle = 90,
    length = 1L,
    iter_n = 1L
  )

one_branch(initial_leaf, params)

```

To grow all the branches in this second layer we use the function `grow_leaf_layers()`. This combines each branch (row) into one data frame that contains one row per new branch. 

```{r}
grow_leaf_layers(initial_leaf,params)
```

The function `grow_leaf()` will do this entire process, creating the initial stalk and growing the new layer (depending on the parameters)

```{r}
grow_leaf(params)
```


And again, we have to clean up the data frame to be easier to plot. We now also have to keep trak of which layer the branch belongs to so the graphing knows which points to connect. 



Now we have two layers. We repeat this growing process at the endpoint of each newly grown branch, untill we have fully grown out the tree. 


## Attempts at speeding up runtime 

